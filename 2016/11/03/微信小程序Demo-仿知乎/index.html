<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>微信小程序Demo--仿知乎 | PETRICHOR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="从微信小程序开始内测到现在, 已经一个月过去了,终于把我自己的微信小程序 demo 墨迹完成了. 真的是墨迹完的, 连我自己都佩服自己的拖延症了(懒癌少女已弃疗ヾ(´A｀)ノﾟ), 总之算是基本完成了(明明有很多组件啊 API 啊根本都没用好嘛 →_→) 以及从来不写 blog 的我也出来码字啦 (ﾉ◕ヮ◕)ﾉ:･ﾟ✧ - 之前有很长一段时间我算是知乎重度依赖, 所以这次 demo 的模仿对象选">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序Demo--仿知乎">
<meta property="og:url" content="http://yoursite.com/2016/11/03/微信小程序Demo-仿知乎/index.html">
<meta property="og:site_name" content="PETRICHOR">
<meta property="og:description" content="从微信小程序开始内测到现在, 已经一个月过去了,终于把我自己的微信小程序 demo 墨迹完成了. 真的是墨迹完的, 连我自己都佩服自己的拖延症了(懒癌少女已弃疗ヾ(´A｀)ノﾟ), 总之算是基本完成了(明明有很多组件啊 API 啊根本都没用好嘛 →_→) 以及从来不写 blog 的我也出来码字啦 (ﾉ◕ヮ◕)ﾉ:･ﾟ✧ - 之前有很长一段时间我算是知乎重度依赖, 所以这次 demo 的模仿对象选">
<meta property="og:locale" content="Chinese English">
<meta property="og:image" content="http://yoursite.com/images/wechat.jpg">
<meta property="og:image" content="http://yoursite.com/images/struct.png">
<meta property="og:image" content="http://yoursite.com/images/index.png">
<meta property="og:image" content="http://yoursite.com/images/discovery1.png">
<meta property="og:image" content="http://yoursite.com/images/discovery2.png">
<meta property="og:image" content="http://yoursite.com/images/notify.png">
<meta property="og:image" content="http://yoursite.com/images/loading.png">
<meta property="og:image" content="http://yoursite.com/images/322675.jpg">
<meta property="og:updated_time" content="2016-11-03T06:30:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微信小程序Demo--仿知乎">
<meta name="twitter:description" content="从微信小程序开始内测到现在, 已经一个月过去了,终于把我自己的微信小程序 demo 墨迹完成了. 真的是墨迹完的, 连我自己都佩服自己的拖延症了(懒癌少女已弃疗ヾ(´A｀)ノﾟ), 总之算是基本完成了(明明有很多组件啊 API 啊根本都没用好嘛 →_→) 以及从来不写 blog 的我也出来码字啦 (ﾉ◕ヮ◕)ﾉ:･ﾟ✧ - 之前有很长一段时间我算是知乎重度依赖, 所以这次 demo 的模仿对象选">
<meta name="twitter:image" content="http://yoursite.com/images/wechat.jpg">
  
    <link rel="alternate" href="/atom.xml" title="PETRICHOR" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">PETRICHOR</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A Girl &amp; A Luftmensch</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-微信小程序Demo-仿知乎" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/03/微信小程序Demo-仿知乎/" class="article-date">
  <time datetime="2016-11-03T02:55:30.000Z" itemprop="datePublished">2016-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      微信小程序Demo--仿知乎
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/wechat.jpg" alt="wechat"></p>
<p><em>从微信小程序开始内测到现在, 已经一个月过去了,终于把我自己的微信小程序 demo 墨迹完成了. 真的是墨迹完的, 连我自己都佩服自己的拖延症了(懒癌少女已弃疗</em>ヾ(´A｀)ノﾟ<em>), 总之算是基本完成了(明明有很多组件啊 API 啊根本都没用好嘛 →_→) 以及从来不写 blog 的我也出来码字啦</em> (ﾉ◕ヮ◕)ﾉ:･ﾟ✧</p>
<p>-</p>
<h6 id="之前有很长一段时间我算是知乎重度依赖-所以这次-demo-的模仿对象选择的是知乎-但是写到一半发现我这个决定坑了-这是后话"><a href="#之前有很长一段时间我算是知乎重度依赖-所以这次-demo-的模仿对象选择的是知乎-但是写到一半发现我这个决定坑了-这是后话" class="headerlink" title="之前有很长一段时间我算是知乎重度依赖, 所以这次 demo 的模仿对象选择的是知乎(但是写到一半发现我这个决定坑了, 这是后话)."></a>之前有很长一段时间我算是知乎重度依赖, 所以这次 demo 的模仿对象选择的是知乎(但是写到一半发现我这个决定坑了, 这是后话).</h6><h6 id="demo-的界面设计以及交互设计均来自于知乎-Android-版本"><a href="#demo-的界面设计以及交互设计均来自于知乎-Android-版本" class="headerlink" title="demo 的界面设计以及交互设计均来自于知乎 Android 版本"></a>demo 的界面设计以及交互设计均来自于知乎 Android 版本</h6><ul>
<li>_工具_: <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html?t=1477579747265" target="_blank" rel="noopener">微信 web 开发者工具</a></li>
</ul>
<p>已经全面对非邀请内测用户开放, 且在持续更新<br>(我码代码的过程中就更新了两版, 所以开发时 IDE 版本不唯一)</p>
<p>不过其实忍受了半个小时微信的开发者工具之后, 我就改在 webstorm 中编辑了, 微信工具成了运行预览的工具, 不过听说IDE 中预览的效果, 也不能保证与真机一样哦~</p>
<ul>
<li><p><em>设计和功能</em>: 知乎安卓版本 非常之简易版</p>
</li>
<li><p>_数据_: 毕竟是知乎, 为了防止版权问题, fake 的数据使用的是我自己的回答, 所以…</p>
</li>
<li><em>项目地址</em>: <a href="https://github.com/RebeccaHanjw/weapp-wechat-zhihu" target="_blank" rel="noopener">https://github.com/RebeccaHanjw/weapp-wechat-zhihu</a></li>
</ul>
<h2 id="–"><a href="#–" class="headerlink" title="–"></a>–</h2><h4 id="1-基础文件"><a href="#1-基础文件" class="headerlink" title="1.  基础文件"></a>1.  基础文件</h4><p>app.json:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;pages&quot;:[</span><br><span class="line">    &quot;pages/index/index&quot;,</span><br><span class="line">    &quot;pages/discovery/discovery&quot;,</span><br><span class="line">    &quot;pages/notify/notify&quot;,</span><br><span class="line">    &quot;pages/chat/chat&quot;,</span><br><span class="line">    &quot;pages/more/more&quot;,</span><br><span class="line">    &quot;pages/answer/answer&quot;,</span><br><span class="line">    &quot;pages/question/question&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;window&quot;:&#123;</span><br><span class="line">    &quot;backgroundTextStyle&quot;:&quot;light&quot;,</span><br><span class="line">    &quot;navigationBarBackgroundColor&quot;: &quot;#0068C4&quot;,</span><br><span class="line">    &quot;navigationBarTitleText&quot;: &quot;知乎&quot;,</span><br><span class="line">    &quot;navigationBarTextStyle&quot;:&quot;white&quot;,</span><br><span class="line">    &quot;enablePullDownRefresh&quot;:true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tabBar&quot;: &#123;</span><br><span class="line">    &quot;color&quot;: &quot;#626567&quot;,</span><br><span class="line">    &quot;selectedColor&quot;: &quot;#2A8CE5&quot;,</span><br><span class="line">    &quot;backgroundColor&quot;: &quot;#FBFBFB&quot;,</span><br><span class="line">    &quot;borderStyle&quot;: &quot;white&quot;,</span><br><span class="line">    &quot;list&quot;: [&#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/index/index&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;images/index.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;images/index_focus.png&quot;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/discovery/discovery&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;images/discovery.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;images/discovery_focus.png&quot;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/notify/notify&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;images/ring.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;images/ring_focus.png&quot;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/chat/chat&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;images/chat.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;images/chat_focus.png&quot;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/more/more&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;images/burger.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;images/burger_focus.png&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;networkTimeout&quot;: &#123;</span><br><span class="line">    &quot;request&quot;: 10000,</span><br><span class="line">    &quot;downloadFile&quot;: 10000</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;debug&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app.json文件中是对整个小程序的全局配置, 主要用到的字段有pages, window, tabBar, networkTimeout.</p>
<ul>
<li><p>pages 字段:  所有小程序的页面都要在该字段中注册, 该字段数组中的第一个page 默认为小程序首页(设置tab 除外), 没有在 pages 字段注册过的页面貌似不能够进行有效的编译(之前版本的编辑器可以,只是会影响配置文件等的生效, 编辑器更新后会报未注册的错误).</p>
</li>
<li><p>window 字段:  大多是关于小程序顶部 navigationbar 的一些设置</p>
</li>
<li><p>tabBar字段: 如果你需要首页面底部带tabbar的样式, 那么就在 tabBar 字段中设置每个 tab 对应的页面, 按顺序对应左至右, 包括路径, tab 文字, tab图标和选中状态图标.</p>
</li>
<li><p>netwoTimeout: 设置网络超时时间.</p>
</li>
<li><p>debug: 开启 debug 模式.</p>
</li>
</ul>
<p>–<br>app.wxss 文件中为全局样式, 也就是说这个文件中的样式在所有的 page 中均可使用, 若其他页面文件的 wxss 中定义了与该样式文件中相同的属性, 则该文件中的样式被覆盖, 规则与 css 优先规则大致相通.</p>
<p>–<br>app.js: 调用 login接口, 回调, 周期函数, 本地存储等等逻辑代码.</p>
<h2 id="–-1"><a href="#–-1" class="headerlink" title="–"></a>–</h2><h4 id="2-页面文件"><a href="#2-页面文件" class="headerlink" title="2. 页面文件:"></a>2. 页面文件:</h4><p><img src="/images/struct.png" alt="struct"></p>
<p>页面文件由四部分组成<br>例如我们有一个首页叫做 index, 则需要在 pages 文件夹下创建文件名相通的三个必要文件:</p>
<ul>
<li>index.wxml</li>
<li>index.wxss</li>
<li>index.js</li>
</ul>
<p><em>另外 index.json文件为可选, 功能与 app.json 相同, 为该页面的配置文件, 但定义功能有限.</em></p>
<h2 id="–-2"><a href="#–-2" class="headerlink" title="–"></a>–</h2><h4 id="3-UI"><a href="#3-UI" class="headerlink" title="3.  UI"></a>3.  UI</h4><h6 id="跟平时开发一样-最开始当然是码-UI"><a href="#跟平时开发一样-最开始当然是码-UI" class="headerlink" title="跟平时开发一样, 最开始当然是码 UI"></a>跟平时开发一样, 最开始当然是码 UI</h6><p>除了需要依照微信的一些新的标签和样式规则, 其他与平时码 UI 并没有太大的不同</p>
<h5 id="需要强调的是-flex-布局在微信小程序中-hin-好用"><a href="#需要强调的是-flex-布局在微信小程序中-hin-好用" class="headerlink" title="需要强调的是, flex 布局在微信小程序中 hin~~~~好用"></a>需要强调的是, flex 布局在微信小程序中 hin~~~~好用</h5><p>不过, 同时作为女生和程序员, 不挑刺可就不是我了, 所以下面列举了一些我遇上的坑, 其中有些也许不正确(多多包涵啦(//∇//)), 有些也许已在 IDE 更新中修正</p>
<h5 id="坑们"><a href="#坑们" class="headerlink" title="坑们:"></a>坑们:</h5><ol>
<li>有一些 css 样式在微信 IDE 中不支持, 例如 font-weight, letter-spacing(及类似调整字间距的样式)等</li>
<li><text>不支持嵌套, 两层<text>嵌套的结构下, 内层<text>中的内容会连续显示两次<br>(在 IDE 后续更新中已修正)</text></text></text></li>
<li>若<view>与<text>在结构上并列的话, 显示上会重合, 感受上类似<view>级别高于<text>, 防止内容相叠, 必须使用<view>相并列. 所以并不能像某些地方说的, 把<view>当做<div>去使用!</div></view></view></text></view></text></view></li>
<li>元素之前有垂直相邻 margin 的时候(符合 margin 折叠规则), 在微信小程序中会double 显示, 即两个元素的 margin 均摊开, 不遵循 margin 折叠规则.</li>
<li><view>标签 hidden 属性无效 ( v0.10.101400 中已修正 )</view></li>
<li>部分情况下, 平级标签 A 与 B 并列, 当 B 通过某些调整向 A 元素位置相叠的时候, 微信 IDE 解析出的效果是 A 的内容和背景色会覆盖 B 元素与之重叠的部分. ( 普通浏览器解析应该是 B 覆盖 A ).</li>
<li>如果用模板+列表渲染的方式来渲染数据的话, 在模板中使用列表渲染的{ {item}}是无效的, 无法被正确识别, 所以列表渲染的时候要把复用的部分写在列表渲染的代码块内 ( 属于数据渲染部分, 后面会提到 )</li>
</ol>
<p>( 待续… … )</p>
<h2 id="–-3"><a href="#–-3" class="headerlink" title="–"></a>–</h2><p>–</p>
<h6 id="后面将对于一些我-demo-中写到用到的部分进行说明"><a href="#后面将对于一些我-demo-中写到用到的部分进行说明" class="headerlink" title="后面将对于一些我 demo 中写到用到的部分进行说明"></a>后面将对于一些我 demo 中写到用到的部分进行说明</h6><h3 id="列表式的数据渲染"><a href="#列表式的数据渲染" class="headerlink" title="列表式的数据渲染"></a>列表式的数据渲染</h3><p>首页</p>
<p><img src="/images/index.png" alt="index"></p>
<p>类似于首页以及发现页这种标准列表式的数据展现方式, 微信提供了很好的方案—列表渲染</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;block wx:for=&quot;&#123; &#123;feed&#125;&#125;&quot; wx:for-index=&quot;idx&quot; wx:for-item=&quot;item&quot; data-idx=&quot;&#123; &#123;idx&#125;&#125;&quot;&gt;</span><br><span class="line">   &lt;view class=&quot;feed-item&quot;&gt;</span><br><span class="line">       &lt;view class=&quot;feed-source&quot;&gt;</span><br><span class="line">           &lt;a class=&quot;&quot;&gt;</span><br><span class="line">               &lt;view class=&quot;avatar&quot;&gt;</span><br><span class="line">                   &lt;image src=&quot;&#123; &#123;item.feed_source_img&#125;&#125;&quot;&gt;&lt;/image&gt;</span><br><span class="line">               &lt;/view&gt;</span><br><span class="line">               &lt;text&gt;&#123; &#123;item.feed_source_name&#125;&#125;&#123; &#123;item.feed_source_txt&#125;&#125;&lt;/text&gt;</span><br><span class="line">           &lt;/a&gt;</span><br><span class="line">           &lt;image class=&quot;item-more&quot; mode=&quot;aspectFit&quot; src=&quot;../../images/more.png&quot;&gt;&lt;/image&gt;</span><br><span class="line">       &lt;/view&gt;</span><br><span class="line">       &lt;view class=&quot;feed-content&quot;&gt;</span><br><span class="line">           &lt;view class=&quot;question&quot; qid=&quot;&#123; &#123;question_id&#125;&#125;&quot; bindtap=&quot;bindQueTap&quot;&gt;</span><br><span class="line">               &lt;a class=&quot;question-link&quot;&gt;</span><br><span class="line">                   &lt;text&gt;&#123; &#123;item.question&#125;&#125;&lt;/text&gt;</span><br><span class="line">               &lt;/a&gt;</span><br><span class="line">           &lt;/view&gt;</span><br><span class="line">           &lt;view class=&quot;answer-body&quot;&gt;</span><br><span class="line">               &lt;view bindtap=&quot;bindItemTap&quot;&gt;</span><br><span class="line">                   &lt;text class=&quot;answer-txt&quot; aid=&quot;&#123; &#123;answer_id&#125;&#125;&quot;&gt;&#123; &#123;item.answer_ctnt&#125;&#125;&lt;/text&gt;</span><br><span class="line">               &lt;/view&gt;</span><br><span class="line">               &lt;view class=&quot;answer-actions&quot; bindtap=&quot;bindItemTap&quot;&gt;</span><br><span class="line">                   &lt;view class=&quot;like dot&quot;&gt;</span><br><span class="line">                       &lt;a&gt;&#123; &#123;item.good_num&#125;&#125; 赞同 &lt;/a&gt;</span><br><span class="line">                   &lt;/view&gt;</span><br><span class="line">                   &lt;view class=&quot;comments dot&quot;&gt;</span><br><span class="line">                       &lt;a&gt;&#123; &#123;item.comment_num&#125;&#125; 评论 &lt;/a&gt;</span><br><span class="line">                   &lt;/view&gt;</span><br><span class="line">                   &lt;view class=&quot;follow-it&quot;&gt;</span><br><span class="line">                       &lt;a&gt;关注问题&lt;/a&gt;</span><br><span class="line">                   &lt;/view&gt;</span><br><span class="line">               &lt;/view&gt;</span><br><span class="line">           &lt;/view&gt;</span><br><span class="line">       &lt;/view&gt;</span><br><span class="line">   &lt;/view&gt;</span><br><span class="line">&lt;/block&gt;</span><br></pre></td></tr></table></figure>
<p>可以直观的看出, 就是 for 循环来用重复的结构渲染一组数据</p>
<ul>
<li>for=”{ {}}”中的内容是想要循环的一组数据, 最外层为数组结构</li>
<li>for-item 指定数组中当前元素的变量名</li>
<li>for-index 指定数组中当前元素下标变量名</li>
</ul>
<h6 id="同样也使用了-for-渲染的还有顶部的发现页和通知页等顶部的自定义-tabbar"><a href="#同样也使用了-for-渲染的还有顶部的发现页和通知页等顶部的自定义-tabbar" class="headerlink" title="同样也使用了 for 渲染的还有顶部的发现页和通知页等顶部的自定义 tabbar"></a>同样也使用了 for 渲染的还有顶部的发现页和通知页等顶部的自定义 tabbar</h6><h3 id="顶部-tabbar-实现"><a href="#顶部-tabbar-实现" class="headerlink" title="顶部 tabbar 实现"></a>顶部 tabbar 实现</h3><p><img src="/images/discovery1.png" alt="discovery1"></p>
<p><img src="/images/discovery2.png" alt="discovery2"></p>
<p><img src="/images/notify.png" alt="notify"></p>
<p>微信只提供了底部 tabbar, 所以顶部的要自己写喽~<br>顶部 tabbar 的实现在于 for 列表渲染以及 js 配合<br>wxml:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class=&quot;top-tab flex-wrp flex-tab &quot; &gt;</span><br><span class="line">  &lt;view class=&quot;toptab flex-item &#123; &#123;currentNavtab==idx ? &apos;active&apos; : &apos;&apos;&#125;&#125;&quot; wx:for=&quot;&#123; &#123;navTab&#125;&#125;&quot; wx:for-index=&quot;idx&quot; wx:for-item=&quot;itemName&quot; data-idx=&quot;&#123; &#123;idx&#125;&#125;&quot; bindtap=&quot;switchTab&quot;&gt;</span><br><span class="line">    &#123; &#123;itemName&#125;&#125;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line">&lt;scroll-view scroll-y=&quot;true&quot; class=&quot;container discovery withtab&quot; bindscrolltoupper=&quot;upper&quot; bindscrolltolower=&quot;lower&quot;  scroll-into-view=&quot;&#123; &#123;toView&#125;&#125;&quot; scroll-top=&quot;&#123; &#123;scrollTop&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;view class=&quot;ctnt0&quot; hidden=&quot;&#123; &#123;currentNavtab==0 ? &apos;&apos; : true&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">  &lt;view class=&quot;ctnt1 placehold&quot; hidden=&quot;&#123; &#123;currentNavtab==1 ? &apos;&apos; : true&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;text&gt;圆桌&lt;/text&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">  &lt;view class=&quot;ctnt2 placehold&quot; hidden=&quot;&#123; &#123;currentNavtab==2 ? &apos;&apos; : true&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;text&gt;热门&lt;/text&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">  &lt;view class=&quot;ctnt3 placehold&quot; hidden=&quot;&#123; &#123;currentNavtab==3 ? &apos;&apos; : true&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;text&gt;收藏&lt;/text&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/scroll-view&gt;</span><br></pre></td></tr></table></figure>
<p>js:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//discovery.js</span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    navTab: [&quot;推荐&quot;, &quot;圆桌&quot;, &quot;热门&quot;, &quot;收藏&quot;],</span><br><span class="line">    currentNavtab: &quot;0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad: function () &#123;</span><br><span class="line">    console.log(&apos;onLoad&apos;)</span><br><span class="line">  &#125;,</span><br><span class="line">  switchTab: function(e)&#123;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      currentNavtab: e.currentTarget.dataset.idx</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>由于微信不支持任何 dom 和 window 对象, 所以 tabbar的实现依赖于微信提供的视图层的展示逻辑, 以及视图与数据之间的绑定机制.<br>绑定点击事件, 通过改变一个 data- 属性的值, 来控制元素的类的改变( 从而改变样式等 )</p>
<h3 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;swiper class=&quot;activity&quot; indicator-dots=&quot;&#123; &#123;indicatorDots&#125;&#125;&quot;</span><br><span class="line">       autoplay=&quot;&#123; &#123;autoplay&#125;&#125;&quot; interval=&quot;&#123; &#123;interval&#125;&#125;&quot; duration=&quot;&#123; &#123;duration&#125;&#125;&quot;&gt;</span><br><span class="line"> &lt;block wx:for=&quot;&#123; &#123;imgUrls&#125;&#125;&quot;&gt;</span><br><span class="line">   &lt;swiper-item&gt;</span><br><span class="line">     &lt;image src=&quot;&#123; &#123;item&#125;&#125;&quot; class=&quot;slide-image&quot; width=&quot;355&quot; height=&quot;155&quot;/&gt;</span><br><span class="line">   &lt;/swiper-item&gt;</span><br><span class="line"> &lt;/block&gt;</span><br><span class="line">&lt;/swiper&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">imgUrls: [</span><br><span class="line"> &apos;../../images/24213.jpg&apos;,</span><br><span class="line"> &apos;../../images/24280.jpg&apos;,</span><br><span class="line"> &apos;../../images/1444983318907-_DSC1826.jpg&apos;</span><br><span class="line">],</span><br><span class="line">indicatorDots: false,</span><br><span class="line">autoplay: true,</span><br><span class="line">interval: 5000,</span><br><span class="line">duration: 1000,</span><br><span class="line">feed: [],</span><br><span class="line">feed_length: 0</span><br></pre></td></tr></table></figure>
<p>轮播图的实现使用的是微信提供的 swiper 组件, 该组件贴心的提供了各种属性选择, 常用的包括autoplay, interval 时间, duration等</p>
<p><swiper-item>中包含的是所有轮播的图片, 为了方便修改图片数据, 同样采用 for 渲染绑定 data 的方式</swiper-item></p>
<h3 id="下拉刷新-上拉加载-以及数据请求"><a href="#下拉刷新-上拉加载-以及数据请求" class="headerlink" title="下拉刷新, 上拉加载, 以及数据请求"></a>下拉刷新, 上拉加载, 以及数据请求</h3><p>刷新及继续加载的动作, 依靠的是<scroll-view>标签, 及配套的upper 和 lower 事件</scroll-view></p>
<p><scroll-view>标签的属性提供了 bindscrolltoupper 和 bindscrolltolower来绑定滚动到顶部及底部所触发的事件, 同时upper-threshold 和 lower-threshold 能够调整触发时距边界的距离</scroll-view></p>
<p>除上述之外, 还提供横向滚动, 滚动触发事件, 及设置滚动条位置等…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;scroll-view scroll-y=&quot;true&quot; class=&quot;container&quot; bindscrolltoupper=&quot;upper&quot; upper-threshold=&quot;10&quot; lower-threshold=&quot;5&quot; bindscrolltolower=&quot;lower&quot;  scroll-into-view=&quot;&#123; &#123;toView&#125;&#125;&quot; scroll-top=&quot;&#123; &#123;scrollTop&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;block wx:for=&quot;&#123; &#123;feed&#125;&#125;&quot; wx:for-index=&quot;idx&quot; wx:for-item=&quot;item&quot; data-idx=&quot;&#123; &#123;idx&#125;&#125;&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;feed-item&quot;&gt;</span><br><span class="line">            &lt;view class=&quot;feed-source&quot;&gt;</span><br><span class="line">                &lt;a class=&quot;&quot;&gt;</span><br><span class="line">                    &lt;view class=&quot;avatar&quot;&gt;</span><br><span class="line">                        &lt;image src=&quot;&#123; &#123;item.feed_source_img&#125;&#125;&quot;&gt;&lt;/image&gt;</span><br><span class="line">                    &lt;/view&gt;</span><br><span class="line">                    &lt;text&gt;&#123; &#123;item.feed_source_name&#125;&#125;&#123; &#123;item.feed_source_txt&#125;&#125;&lt;/text&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">                &lt;image class=&quot;item-more&quot; mode=&quot;aspectFit&quot; src=&quot;../../images/more.png&quot;&gt;&lt;/image&gt;</span><br><span class="line">            &lt;/view&gt;</span><br><span class="line">            &lt;view class=&quot;feed-content&quot;&gt;</span><br><span class="line">                &lt;view class=&quot;question&quot; qid=&quot;&#123; &#123;question_id&#125;&#125;&quot; bindtap=&quot;bindQueTap&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;question-link&quot;&gt;</span><br><span class="line">                        &lt;text&gt;&#123; &#123;item.question&#125;&#125;&lt;/text&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/view&gt;</span><br><span class="line">                &lt;view class=&quot;answer-body&quot;&gt;</span><br><span class="line">                    &lt;view bindtap=&quot;bindItemTap&quot;&gt;</span><br><span class="line">                        &lt;text class=&quot;answer-txt&quot; aid=&quot;&#123; &#123;answer_id&#125;&#125;&quot;&gt;&#123; &#123;item.answer_ctnt&#125;&#125;&lt;/text&gt;</span><br><span class="line">                    &lt;/view&gt;</span><br><span class="line">                    &lt;view class=&quot;answer-actions&quot; bindtap=&quot;bindItemTap&quot;&gt;</span><br><span class="line">                        &lt;view class=&quot;like dot&quot;&gt;</span><br><span class="line">                            &lt;a&gt;&#123; &#123;item.good_num&#125;&#125; 赞同 &lt;/a&gt;</span><br><span class="line">                        &lt;/view&gt;</span><br><span class="line">                        &lt;view class=&quot;comments dot&quot;&gt;</span><br><span class="line">                            &lt;a&gt;&#123; &#123;item.comment_num&#125;&#125; 评论 &lt;/a&gt;</span><br><span class="line">                        &lt;/view&gt;</span><br><span class="line">                        &lt;view class=&quot;follow-it&quot;&gt;</span><br><span class="line">                            &lt;a&gt;关注问题&lt;/a&gt;</span><br><span class="line">                        &lt;/view&gt;</span><br><span class="line">                    &lt;/view&gt;</span><br><span class="line">                &lt;/view&gt;</span><br><span class="line">            &lt;/view&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">    &lt;/block&gt;</span><br><span class="line">&lt;/scroll-view&gt;</span><br></pre></td></tr></table></figure>
<p>滚动至顶或至底时, 触发的加载数据的事件, 本应该调用微信提供的网络请求 API 来获取数据. 但是比较坑的是, 我在选择写仿知乎 demo 的时候没有注意到知乎不提供开放 API, 而微信的 API 不支持直接对.json 文件进行本地请求, 无奈之下, 选择在 js 文件中伪造一段数据, module.exports抛出, 来 fake 数据请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">upper: function () &#123;</span><br><span class="line">    wx.showNavigationBarLoading()</span><br><span class="line">    this.refresh();</span><br><span class="line">    console.log(&quot;upper&quot;);</span><br><span class="line">    setTimeout(function()&#123;wx.hideNavigationBarLoading();wx.stopPullDownRefresh();&#125;, 2000);</span><br><span class="line">  &#125;,</span><br><span class="line">  lower: function (e) &#123;</span><br><span class="line">    wx.showNavigationBarLoading();</span><br><span class="line">    var that = this;</span><br><span class="line">    setTimeout(function()&#123;wx.hideNavigationBarLoading();that.nextLoad();&#125;, 1000);</span><br><span class="line">    console.log(&quot;lower&quot;)</span><br><span class="line">  &#125;,</span><br><span class="line">  //scroll: function (e) &#123;</span><br><span class="line">  //  console.log(&quot;scroll&quot;)</span><br><span class="line">  //&#125;,</span><br><span class="line"></span><br><span class="line">  //网络请求数据, 实现刷新</span><br><span class="line">  refresh0: function()&#123;</span><br><span class="line">    var index_api = &apos;&apos;;</span><br><span class="line">    util.getData(index_api)</span><br><span class="line">        .then(function(data)&#123;</span><br><span class="line">          //this.setData(&#123;</span><br><span class="line">          //</span><br><span class="line">          //&#125;);</span><br><span class="line">          console.log(data);</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  //使用本地 fake 数据实现刷新效果</span><br><span class="line">  refresh: function()&#123;</span><br><span class="line">    var feed = util.getDiscovery();</span><br><span class="line">    console.log(&quot;loaddata&quot;);</span><br><span class="line">    var feed_data = feed.data;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      feed:feed_data,</span><br><span class="line">      feed_length: feed_data.length</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  //使用本地 fake 数据实现继续加载效果</span><br><span class="line">  nextLoad: function()&#123;</span><br><span class="line">    var next = util.discoveryNext();</span><br><span class="line">    console.log(&quot;continueload&quot;);</span><br><span class="line">    var next_data = next.data;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      feed: this.data.feed.concat(next_data),</span><br><span class="line">      feed_length: this.data.feed_length + next_data.length</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>由于是 fake 的数据, 所以这个 demo 并没有做真实的带参跳转, 查询等功能</p>
<p>加载数据的同时, 使用微信提供的加载动画wx.showNavigationBarLoading();</p>
<p><img src="/images/loading.png" alt="loading"></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>绑定点击事件, 进行页面的跳转wx.navigateTo</li>
<li>部分模块化</li>
<li>input, image 组件等</li>
</ul>
<h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><p>其实还有大量的组件和 API 还没有用过, 这个 demo 也许后续还会有更新呦, 这取决于懒癌少女的病情严重程度了</p>
<h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p>传送门: <a href="https://github.com/RebeccaHanjw/weapp-wechat-zhihu" target="_blank" rel="noopener">https://github.com/RebeccaHanjw/weapp-wechat-zhihu</a></p>
<h3 id="也许算是些感受"><a href="#也许算是些感受" class="headerlink" title="也许算是些感受?"></a>也许算是些感受?</h3><p>其实作为一个小前端, 由于工作中的原因, 使用 MVVM 其实非常少的, 不过写了这个微信小程序 demo 之后, 更加把这方便的思维理顺了. 当然, 写完之后回头看, 还是有超多的不足, 明明好些地方能再换一种写法的. 不过毕竟是我第一次尝试用新鲜热乎的东西写小 demo, 也是第一次尝试写教程…或者算是记录? whatever~~</p>
<p>还有, 非项目的配图均来自网络哦~~</p>
<h5 id="Anyway-希望除了写代码之外-还能在码文字的道路上也多走走吧-毕竟我是要做代码小仙女的人呀-≧∀≦-ゞ"><a href="#Anyway-希望除了写代码之外-还能在码文字的道路上也多走走吧-毕竟我是要做代码小仙女的人呀-≧∀≦-ゞ" class="headerlink" title="Anyway~ 希望除了写代码之外, 还能在码文字的道路上也多走走吧, 毕竟我是要做代码小仙女的人呀(≧∀≦)ゞ"></a>Anyway~ 希望除了写代码之外, 还能在码文字的道路上也多走走吧, 毕竟我是要做代码小仙女的人呀(≧∀≦)ゞ</h5><p><img src="/images/322675.jpg" alt="322675"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/03/微信小程序Demo-仿知乎/" data-id="cjivf703m0005kc93ng74spjo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/08/并列 inline-block 元素间隙问题/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          并列 inline-block 元素间隙问题
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/06/26/组建一个跨平台移动端团队（译）/">组建一个跨平台移动端团队（译）</a>
          </li>
        
          <li>
            <a href="/2018/06/25/Airbnb 的 React Native 经验/">Airbnb 的 React Native 经验(译)</a>
          </li>
        
          <li>
            <a href="/2017/09/18/webpack/">webpack</a>
          </li>
        
          <li>
            <a href="/2017/04/06/Alfred-平台的知乎搜索-workflow/">Alfred 平台的知乎搜索 workflow</a>
          </li>
        
          <li>
            <a href="/2017/03/08/并列 inline-block 元素间隙问题/">并列 inline-block 元素间隙问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Rebecca Han<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>-->
<script src="http://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"> </script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>